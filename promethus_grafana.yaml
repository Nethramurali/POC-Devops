-
    hosts: localhost
    connection: local 
    become: yes 
    tasks:

      - name: add the â€˜prometheus-communityâ€™ chart repository
        shell: |
          helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
          helm repo update
        ignore_errors: True 


      - name: Deploy Prometheus
        shell:
           helm install kube-prometheus-stack --create-namespace --namespace kube-prometheus-stack prometheus-community/kube-prometheus-stack
      
      - name: port forwarding for prometheus
        shell:
          "nohup kubectl port-forward -n kube-prometheus-stack svc/kube-prometheus-stack-prometheus 9090:9090 --address=0.0.0.0 >/dev/null 2>&1 &"
        tags: grafana

      - name: port forwarding for grafana
        shell:
          "nohup kubectl port-forward -n kube-prometheus-stack svc/kube-prometheus-stack-grafana 80:80 --address=0.0.0.0 >/dev/null 2>&1 &"
        tags:
          - grafana
           
          

   

      
         
